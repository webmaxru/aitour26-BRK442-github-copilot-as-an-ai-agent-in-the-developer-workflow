<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Store</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; color: #333; }
        header { background: #0078d4; color: #fff; padding: 1rem 2rem; }
        header h1 { font-size: 1.5rem; }
        main { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: #fff; border-radius: 6px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); padding: 1.5rem; margin-bottom: 1.5rem; }
        .card h2 { margin-bottom: 1rem; font-size: 1.1rem; color: #0078d4; }
        .form-row { display: flex; gap: 0.75rem; flex-wrap: wrap; }
        .form-row input { flex: 1; min-width: 150px; padding: 0.5rem 0.75rem; border: 1px solid #ccc; border-radius: 4px; font-size: 0.95rem; }
        .btn { padding: 0.5rem 1.25rem; border: none; border-radius: 4px; cursor: pointer; font-size: 0.95rem; }
        .btn-primary { background: #0078d4; color: #fff; }
        .btn-primary:hover { background: #005fa3; }
        .btn-danger { background: #d93025; color: #fff; }
        .btn-danger:hover { background: #b02318; }
        .btn-secondary { background: #eee; color: #333; }
        .btn-secondary:hover { background: #ddd; }
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 0.75rem 1rem; border-bottom: 1px solid #eee; }
        th { background: #f0f4f8; font-weight: 600; }
        tr:last-child td { border-bottom: none; }
        .actions { display: flex; gap: 0.5rem; }
        #message { padding: 0.75rem 1rem; border-radius: 4px; margin-bottom: 1rem; display: none; }
        #message.success { background: #e6f4ea; color: #1e7e34; border: 1px solid #c3e6cb; }
        #message.error { background: #fce8e6; color: #c5221f; border: 1px solid #f5c6cb; }
        #empty-state { text-align: center; color: #888; padding: 2rem 0; }
        .edit-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); align-items: center; justify-content: center; }
        .edit-modal.active { display: flex; }
        .modal-box { background: #fff; border-radius: 6px; padding: 1.5rem; width: 400px; max-width: 95%; }
        .modal-box h3 { margin-bottom: 1rem; }
        .modal-box .form-row { flex-direction: column; }
        .modal-box .form-row input { min-width: unset; }
        .modal-actions { display: flex; gap: 0.5rem; justify-content: flex-end; margin-top: 1rem; }
    </style>
</head>
<body>
    <header>
        <h1>Product Store</h1>
    </header>
    <main>
        <div id="message"></div>

        <div class="card">
            <h2>Add Product</h2>
            <div class="form-row">
                <input type="text" id="new-name" placeholder="Product name (required)" />
                <input type="text" id="new-description" placeholder="Description (optional)" />
                <button class="btn btn-primary" onclick="createProduct()">Add</button>
            </div>
        </div>

        <div class="card">
            <h2>Products</h2>
            <div id="empty-state" style="display:none;">No products found. Add one above.</div>
            <table id="products-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>ID</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="products-body"></tbody>
            </table>
        </div>
    </main>

    <!-- Edit Modal -->
    <div class="edit-modal" id="edit-modal">
        <div class="modal-box">
            <h3>Edit Product</h3>
            <div class="form-row">
                <input type="text" id="edit-name" placeholder="Product name (required)" />
                <input type="text" id="edit-description" placeholder="Description (optional)" />
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveEdit()">Save</button>
            </div>
        </div>
    </div>

    <script>
        let editingId = null;

        function showMessage(text, type) {
            const el = document.getElementById('message');
            el.textContent = text;
            el.className = type;
            el.style.display = 'block';
            setTimeout(() => { el.style.display = 'none'; }, 3000);
        }

        async function loadProducts() {
            try {
                const res = await fetch('/products');
                const products = await res.json();
                renderProducts(products);
            } catch (e) {
                showMessage('Failed to load products.', 'error');
            }
        }

        function renderProducts(products) {
            const tbody = document.getElementById('products-body');
            const empty = document.getElementById('empty-state');
            const table = document.getElementById('products-table');
            tbody.innerHTML = '';
            if (products.length === 0) {
                empty.style.display = 'block';
                table.style.display = 'none';
            } else {
                empty.style.display = 'none';
                table.style.display = 'table';
                products.forEach(p => {
                    const tr = document.createElement('tr');

                    const tdName = document.createElement('td');
                    tdName.textContent = p.name;

                    const tdDesc = document.createElement('td');
                    tdDesc.textContent = p.description || '';

                    const tdId = document.createElement('td');
                    tdId.textContent = p.id;
                    tdId.style.cssText = 'font-size:0.8rem;color:#888;';

                    const editBtn = document.createElement('button');
                    editBtn.className = 'btn btn-secondary';
                    editBtn.textContent = 'Edit';
                    editBtn.addEventListener('click', () => openEditModal(p.id, p.name, p.description || ''));

                    const delBtn = document.createElement('button');
                    delBtn.className = 'btn btn-danger';
                    delBtn.textContent = 'Delete';
                    delBtn.addEventListener('click', () => deleteProduct(p.id));

                    const tdActions = document.createElement('td');
                    tdActions.className = 'actions';
                    tdActions.appendChild(editBtn);
                    tdActions.appendChild(delBtn);

                    tr.appendChild(tdName);
                    tr.appendChild(tdDesc);
                    tr.appendChild(tdId);
                    tr.appendChild(tdActions);
                    tbody.appendChild(tr);
                });
            }
        }

        async function createProduct() {
            const name = document.getElementById('new-name').value.trim();
            const description = document.getElementById('new-description').value.trim();
            if (!name) { showMessage('Product name is required.', 'error'); return; }
            try {
                const res = await fetch('/products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description })
                });
                if (res.ok) {
                    document.getElementById('new-name').value = '';
                    document.getElementById('new-description').value = '';
                    showMessage('Product created successfully.', 'success');
                    loadProducts();
                } else {
                    showMessage('Failed to create product.', 'error');
                }
            } catch (e) {
                showMessage('Failed to create product.', 'error');
            }
        }

        function openEditModal(id, name, description) {
            editingId = id;
            document.getElementById('edit-name').value = name;
            document.getElementById('edit-description').value = description;
            document.getElementById('edit-modal').classList.add('active');
        }

        function closeEditModal() {
            editingId = null;
            document.getElementById('edit-modal').classList.remove('active');
        }

        async function saveEdit() {
            const name = document.getElementById('edit-name').value.trim();
            const description = document.getElementById('edit-description').value.trim();
            if (!name) { showMessage('Product name is required.', 'error'); return; }
            try {
                const res = await fetch(`/products/${editingId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description })
                });
                if (res.ok) {
                    closeEditModal();
                    showMessage('Product updated successfully.', 'success');
                    loadProducts();
                } else {
                    showMessage('Failed to update product.', 'error');
                }
            } catch (e) {
                showMessage('Failed to update product.', 'error');
            }
        }

        async function deleteProduct(id) {
            if (!confirm('Delete this product?')) return;
            try {
                const res = await fetch(`/products/${id}`, { method: 'DELETE' });
                if (res.ok) {
                    showMessage('Product deleted.', 'success');
                    loadProducts();
                } else {
                    showMessage('Failed to delete product.', 'error');
                }
            } catch (e) {
                showMessage('Failed to delete product.', 'error');
            }
        }

        loadProducts();
    </script>
</body>
</html>
